# vim: set syntax=dockerfile
FROM iamdork/composer:7

ONBUILD ARG COMPOSER_APPROOT="/var/www"
ONBUILD ENV COMPOSER_APPROOT=${COMPOSER_APPROOT}

ONBUILD ARG COMPOSER_WEBROOT="web"
ONBUILD ENV COMPOSER_WEBROOT=${COMPOSER_WEBROOT}

ONBUILD ENV APACHE_DOCROOT=$COMPOSER_APPROOT/$COMPOSER_WEBROOT

ONBUILD ARG VAULT_TOKEN=''
ONBUILD ENV VAULT_TOKEN=${VAULT_TOKEN}
ONBUILD ARG VAULT_ADDR='http://172.17.0.1'
ONBUILD ARG ACCEPT_HOSTS="github.com bitbucket.org"

ONBUILD RUN mkdir -p $APACHE_DOCROOT
ONBUILD COPY composer.json $COMPOSER_APPROOT/composer.json
ONBUILD COPY composer.lock $COMPOSER_APPROOT/composer.lock
ONBUILD RUN bash /dork/composer/composer-install.sh
ONBUILD COPY . $COMPOSER_APPROOT
WORKDIR $COMPOSER_APPROOT

