# vim: set ft=dockerfile:
FROM iamdork/drupal:8

ONBUILD ARG DRUPAL_WEBROOT='web'
ONBUILD ENV WEBROOT=${DRUPAL_WEBROOT}
ONBUILD ENV DOCROOT=/var/www/html/${WEBROOT}

ONBUILD ARG VAULT_TOKEN=''
ONBUILD ENV VAULT_TOKEN=${VAULT_TOKEN}
ONBUILD ARG VAULT_ADDR='http://172.17.0.1'
ONBUILD ARG ACCEPT_HOSTS="github.com bitbucket.org"

ONBUILD COPY composer.json /var/www/html/composer.json
ONBUILD COPY composer.lock /var/www/html/composer.lock
ONBUILD COPY patches /var/www/html/patches
ONBUILD COPY scripts/composer /var/www/html/scripts/composer
ONBUILD COPY ${WEBROOT}/sites/default /var/www/html/${WEBROOT}/sites/default
ONBUILD ENV DRUPAL_CONFIG_DIR=../config

ONBUILD RUN bash /dork/composer/composer-install.sh
ONBUILD COPY . /var/www/html

LABEL dork.hotcode="drush/custom;web/modules/custom;web/themes/custom;web/profiles/custom"
LABEL dork.dependencies="vendor;drush/contrib;web/core;web/modules/contrib;web/themes/contrib;web/profiles/contrib"
