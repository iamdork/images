# vim: syntax=dockerfile
FROM php:7-apache

ENV DEVELOPMENT="no" \
    VIRTUAL_HOST="localhost" \
    XDEBUG_REMOTE_HOST="" \
    APACHE_ADMIN_EMAIL="admin@localhost" \
    APACHE_DOCROOT="/var/www/html" \
    MYSQL_HOST="database" \
    MYSQL_PORT="3306" \
    MYSQL_USER="" \
    MYSQL_PASSWORD="" \
    MYSQL_DATABASE="database"

RUN a2enmod rewrite

# Install basic cli tools and required packages.
RUN apt-get update \
  && apt-get install -y ssmtp git curl mysql-client rsync vim libpng12-dev libjpeg-dev libpq-dev \
  && rm -rf /var/lib/apt/lists/* \
  && docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \
  && docker-php-ext-install gd bcmath mbstring opcache pdo pdo_mysql pdo_pgsql zip \
  && pecl install xdebug

# Install the init shellscript.
COPY init.sh /dork/init/init.sh
RUN chmod +x /dork/init/init.sh

# Create a symbolic link to our setup script, that can easily be replaced by
#Â a deriving image.
COPY setup-php.sh /dork/init/setup-php.sh
RUN ln -s /dork/init/setup-php.sh /dork/init/setup.sh

COPY development.ini /dork/config/development.ini
COPY 000-default.conf /etc/apache2/sites-available/000-default.conf

CMD ["/dork/init/init.sh"]

